(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[959],{1296:(e,t,s)=>{"use strict";s.d(t,{P:()=>x});var n=s(2115);let l={title_exact:100,title_partial:60,chorus_weight:55,verse1_weight:45,lyrics_weight:20,unit_weight:15,fuzzy_weight:10};function r(e){return"string"!=typeof e?"":e.normalize("NFC").replace(/\s+/g," ").trim().toLowerCase()}function i(e,t){let s=r(e);if(!s||!t)return!1;if(s.includes(t))return!0;let n=t.split(" ").filter(Boolean);return!(n.length<=1)&&n.every(e=>s.includes(e))}function a(e,t,s){let n=[],l=0,a=r(t),c=r(e.title);return a&&(c===a?(l+=s.title_exact,n.push("title_exact")):c.includes(a)&&(l+=s.title_partial,n.push("title_partial")),i(e.chorus_first_line,a)&&(l+=s.chorus_weight,n.push("chorus_first_line")),i(e.verse1_first_line,a)&&(l+=s.verse1_weight,n.push("verse1_first_line")),i(e.lyrics_full,a)&&(l+=s.lyrics_weight,n.push("lyrics_full")),(Array.isArray(e.two_line_units)?e.two_line_units:[]).some(e=>i(e,a))&&(l+=s.unit_weight,n.push("two_line_units"))),{score:l,matchedFields:n}}function c(e){return{...l,...null!=e?e:{}}}let o=new Map,u=null,d=null;async function h(){if(u)return u;if(d)return d;d=(async()=>{let e=await fetch("/data/songs.json",{cache:"no-store"});if(!e.ok)throw Error("Failed to load songs.json (".concat(e.status,")"));let t=await e.json();if(!Array.isArray(t))throw Error("Invalid songs.json format: expected an array");return u=t})();try{return await d}finally{d=null}}function x(e){var t,s,l;let i=null!=(t=e.debounceMs)?t:120,u=null!=(s=e.cacheTtlMs)?s:2e4,d=null!=(l=e.includeSuggestions)&&l,[x,m]=(0,n.useState)(""),[f,g]=(0,n.useState)([]),[p,_]=(0,n.useState)([]),[j,w]=(0,n.useState)(e.initialWeights),[y,b]=(0,n.useState)(!1),[N,v]=(0,n.useState)(null),C=(0,n.useRef)(0),k=(0,n.useRef)(null),z=(0,n.useRef)(null),S=(0,n.useRef)(new Map),A=(0,n.useCallback)(()=>{C.current+=1,z.current=null,g([]),_([]),b(!1),v(null)},[]),E=(0,n.useCallback)(t=>{var s,n,l;g(null!=(s=t.results)?s:[]),_(null!=(n=t.suggestions)?n:[]),w(null!=(l=t.weights)?l:e.initialWeights),v(null)},[e.initialWeights]),M=(0,n.useCallback)(async(t,s,n)=>{if(z.current===s)return;let l=C.current+1;C.current=l,z.current=s,n||(b(!0),v(null));try{let n=await h();if(l!==C.current)return;let i=e.initialWeights,x=(function(e,t,s){let n=c(s);return e.map(e=>{let{score:s,matchedFields:l}=a(e,t,n);return{song:e,score:s,matched_fields:l}}).filter(e=>e.score>0).sort((e,t)=>t.score-e.score||e.song.title.localeCompare(t.song.title))})(n,t,i).slice(0,50),m=d?function(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,l=r(t);if(!l)return[];let i=c(s),o=Math.max(1,Math.floor(.45*l.length));return e.map(e=>{let t=function(e,t){let s=r(t),n=r(e.title);if(!s||!n)return 1/0;if(n===s)return 0;if(!n.length)return s.length;if(!s.length)return n.length;let l=Array.from({length:n.length+1},(e,t)=>Array.from({length:s.length+1},(e,s)=>0===t?s:0===s?t:0));for(let e=1;e<=n.length;e+=1)for(let t=1;t<=s.length;t+=1){let r=+(n[e-1]!==s[t-1]);l[e][t]=Math.min(l[e-1][t]+1,l[e][t-1]+1,l[e-1][t-1]+r)}return l[n.length][s.length]}(e,l);if(!(t<=o))return null;let{score:s}=a(e,l,i),n=s+i.fuzzy_weight;return{song_id:e.id,title:e.title,score:n,distance:t}}).filter(e=>!!e).sort((e,t)=>t.score-e.score||e.distance-t.distance||e.title.localeCompare(t.title)).slice(0,n)}(n,t,i,8):[],f={query:t,weights:i,results:x,suggestions:m};E(f);let g=Date.now();o.set(s,{expiresAt:g+u,fetchedAt:g,payload:f}),S.current.set(s,g)}catch(e){if(l!==C.current)return;n||(g([]),_([]),v(e instanceof Error?e.message:"Unknown error"))}finally{l!==C.current||n||b(!1),z.current===s&&(z.current=null)}},[E,u,d,e.initialWeights]),R=(0,n.useCallback)(async(e,t)=>{var s,n;let l=e.trim();if(!l)return void A();let r=function(e,t){let s=e.trim().normalize("NFC").toLowerCase();return"".concat(t?"1":"0",":").concat(s)}(l,d),i=Date.now();for(let[e,t]of o.entries())t.fetchedAt+12e4<=i&&o.delete(e);for(;o.size>120;){let e=o.keys().next().value;if(!e)break;o.delete(e)}let a=o.get(r);t&&a&&(E(a.payload),b(!1));let c=!!(a&&a.expiresAt>i),u=null!=(n=null!=(s=S.current.get(r))?s:null==a?void 0:a.fetchedAt)?n:0;if(t&&c){i-u>350&&z.current!==r&&M(l,r,!0);return}(!t||z.current!==r)&&(t&&i-u<=350||await M(l,r,t&&!!a))},[E,M,d,A]);(0,n.useEffect)(()=>(null!==k.current&&(window.clearTimeout(k.current),k.current=null),x.trim())?(k.current=window.setTimeout(()=>{R(x,!0)},i),()=>{null!==k.current&&(window.clearTimeout(k.current),k.current=null)}):void A(),[i,x,A,R]),(0,n.useEffect)(()=>()=>{null!==k.current&&window.clearTimeout(k.current)},[]);let T=(0,n.useCallback)(async()=>{await R(x,!0)},[x,R]);return{query:x,setQuery:m,results:f,suggestions:p,weights:j,loading:y,error:N,searchNow:T}}},2853:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>u});var n=s(5155),l=s(2619),r=s.n(l);function i(e){var t;let{result:s}=e;return(0,n.jsxs)("article",{className:"panel p-5",children:[(0,n.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-xl font-bold text-[#131b2e]",children:(0,n.jsx)(r(),{href:"/song/".concat(encodeURIComponent(s.song.id),"/index"),className:"hover:underline",children:s.song.title})}),(0,n.jsx)("p",{className:"mt-1 text-sm text-slate-500",children:null!=(t=s.song.artist)?t:"Unknown Artist"})]}),(0,n.jsxs)("span",{className:"rounded-full bg-[#1f57d9]/10 px-3 py-1 text-sm font-semibold text-[#1f57d9]",children:["Score ",s.score]})]}),(0,n.jsxs)("div",{className:"mt-4 space-y-2 text-sm text-slate-700",children:[(0,n.jsxs)("p",{children:[(0,n.jsx)("span",{className:"font-semibold",children:"Chorus:"})," ",s.song.chorus_first_line]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("span",{className:"font-semibold",children:"Verse 1:"})," ",s.song.verse1_first_line]})]}),(0,n.jsx)("div",{className:"mt-4 flex flex-wrap gap-2",children:s.matched_fields.map(e=>(0,n.jsx)("span",{className:"rounded-md bg-slate-100 px-2 py-1 text-xs font-medium text-slate-600",children:e},e))})]})}var a=s(1296),c=s(4484);let o={title_exact:100,title_partial:60,chorus_weight:55,verse1_weight:45,lyrics_weight:20,unit_weight:15,fuzzy_weight:10};function u(){let{query:e,setQuery:t,results:s,suggestions:l,weights:u,loading:d,error:h,searchNow:x}=(0,a.P)({initialWeights:o,includeSuggestions:!0});return(0,n.jsxs)("section",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"panel p-6",children:[(0,n.jsx)("h1",{className:"text-3xl font-black text-strong",children:"Search Engine"}),(0,n.jsx)("p",{className:"mt-2 text-sm text-soft",children:"title / chorus_first_line / verse1_first_line / lyrics_full / two_line_units"}),(0,n.jsxs)("form",{className:"mt-5 flex gap-3",onSubmit:e=>{e.preventDefault(),x()},children:[(0,n.jsx)("input",{className:"input flex-1",placeholder:"곡 제목 또는 가사 일부를 입력하세요",value:e,onChange:e=>t(e.target.value)}),(0,n.jsx)("button",{type:"submit",className:"btn-primary min-w-[120px]",disabled:d,children:d?"Searching...":"Search"})]}),(0,n.jsx)("p",{className:"mt-2 text-xs font-semibold text-muted",children:"입력 즉시 DB 결과가 아래에 표시됩니다."}),e.trim()?(0,n.jsxs)("div",{className:"mt-3 rounded-[2px] border-2 border-soft bg-solid p-3",children:[(0,n.jsxs)("p",{className:"text-xs font-semibold uppercase tracking-[0.08em] text-muted",children:["DB Matches (",s.length,")"]}),(0,n.jsx)("div",{className:"mt-2 max-h-52 space-y-2 overflow-y-auto pr-1",children:d?(0,n.jsx)("p",{className:"text-sm text-muted",children:"검색 중..."}):s.length>0?s.slice(0,12).map((e,t)=>(0,n.jsxs)(r(),{href:"/song/".concat(encodeURIComponent(e.song.id),"/index"),prefetch:!1,className:"block rounded-[2px] border border-soft bg-panel px-3 py-2 text-sm transition hover:border-[var(--primary)]",children:[(0,n.jsx)("p",{className:"text-[11px] font-medium text-muted",children:(0,c.b)(e.song)}),(0,n.jsx)("p",{className:"font-semibold text-strong",children:e.song.title})]},"".concat(e.song.id,"-").concat(t))):(0,n.jsx)("p",{className:"text-sm text-muted",children:"일치하는 곡이 없습니다."})})]}):null,(0,n.jsxs)("div",{className:"mt-5 grid gap-2 text-xs text-muted sm:grid-cols-2 lg:grid-cols-4",children:[(0,n.jsxs)("p",{children:["Title Exact: ",u.title_exact]}),(0,n.jsxs)("p",{children:["Title Partial: ",u.title_partial]}),(0,n.jsxs)("p",{children:["Chorus: ",u.chorus_weight]}),(0,n.jsxs)("p",{children:["Verse1: ",u.verse1_weight]}),(0,n.jsxs)("p",{children:["Lyrics: ",u.lyrics_weight]}),(0,n.jsxs)("p",{children:["Two-line Units: ",u.unit_weight]}),(0,n.jsxs)("p",{children:["Fuzzy Bonus (suggestions): ",u.fuzzy_weight]})]}),h?(0,n.jsx)("p",{className:"mt-4 text-sm font-medium text-red-600",children:h}):null]}),(0,n.jsxs)("div",{className:"grid gap-6 lg:grid-cols-[1fr_320px]",children:[(0,n.jsxs)("section",{className:"space-y-4",children:[(0,n.jsxs)("h2",{className:"text-xl font-bold text-strong",children:["Results (",s.length,")"]}),s.length>0?s.map((e,t)=>(0,n.jsx)(i,{result:e},"".concat(e.song.id,"-").concat(t))):(0,n.jsx)("div",{className:"panel p-6 text-sm text-soft",children:"검색 결과가 없습니다."})]}),(0,n.jsxs)("aside",{className:"panel h-fit p-5",children:[(0,n.jsx)("h2",{className:"text-base font-semibold text-strong",children:"Suggestions (Fuzzy)"}),(0,n.jsx)("p",{className:"mt-1 text-xs text-muted",children:"Fuzzy bonus applies only here."}),(0,n.jsx)("div",{className:"mt-4 space-y-2",children:l.length>0?l.map(e=>(0,n.jsxs)(r(),{href:"/song/".concat(encodeURIComponent(e.song_id),"/index"),prefetch:!1,className:"block rounded-lg border border-soft bg-panel px-3 py-2 text-sm transition hover:border-[var(--primary)]",children:[(0,n.jsx)("p",{className:"font-semibold text-strong",children:e.title}),(0,n.jsxs)("p",{className:"text-xs text-muted",children:["score ",e.score," / distance ",e.distance]})]},e.song_id)):(0,n.jsx)("p",{className:"text-sm text-muted",children:"추천 결과가 없습니다."})})]})]})]})}},4484:(e,t,s)=>{"use strict";function n(e){return e?e.trim():""}function l(e){let t=n(e.artist),s=n(e.ccli_number),l=n(e.copyright_holder),r=[];return(t&&r.push(t),s&&r.push("CCLI ".concat(s)),l&&r.push(l),0===r.length)?"Unknown Artist":r.join(" \xb7 ")}s.d(t,{b:()=>l})},4817:(e,t,s)=>{Promise.resolve().then(s.bind(s,2853))}},e=>{e.O(0,[619,441,255,358],()=>e(e.s=4817)),_N_E=e.O()}]);