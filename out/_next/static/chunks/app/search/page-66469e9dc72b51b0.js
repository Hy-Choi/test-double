(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[959],{1296:(e,t,s)=>{"use strict";s.d(t,{P:()=>x});var l=s(2115);let r={title_exact:100,title_partial:60,chorus_weight:55,verse1_weight:45,lyrics_weight:20,unit_weight:15,fuzzy_weight:10};function n(e){return"string"!=typeof e?"":e.normalize("NFC").replace(/\s+/g," ").trim().toLowerCase()}function i(e,t){let s=n(e);if(!s||!t)return!1;if(s.includes(t))return!0;let l=t.split(" ").filter(Boolean);return!(l.length<=1)&&l.every(e=>s.includes(e))}function a(e,t,s){let l=[],r=0,a=n(t),c=n(e.title);return a&&(c===a?(r+=s.title_exact,l.push("title_exact")):c.includes(a)&&(r+=s.title_partial,l.push("title_partial")),i(e.chorus_first_line,a)&&(r+=s.chorus_weight,l.push("chorus_first_line")),i(e.verse1_first_line,a)&&(r+=s.verse1_weight,l.push("verse1_first_line")),i(e.lyrics_full,a)&&(r+=s.lyrics_weight,l.push("lyrics_full")),(Array.isArray(e.two_line_units)?e.two_line_units:[]).some(e=>i(e,a))&&(r+=s.unit_weight,l.push("two_line_units"))),{score:r,matchedFields:l}}function c(e){return{...r,...null!=e?e:{}}}let u=new Map,o=null,d=null;async function h(){if(o)return o;if(d)return d;d=(async()=>{let e=await fetch("/data/songs.json",{cache:"no-store"});if(!e.ok)throw Error("Failed to load songs.json (".concat(e.status,")"));let t=await e.json();if(!Array.isArray(t))throw Error("Invalid songs.json format: expected an array");return o=t})();try{return await d}finally{d=null}}function x(e){var t,s,r;let i=null!=(t=e.debounceMs)?t:120,o=null!=(s=e.cacheTtlMs)?s:2e4,d=null!=(r=e.includeSuggestions)&&r,[x,m]=(0,l.useState)(""),[f,g]=(0,l.useState)([]),[p,_]=(0,l.useState)([]),[j,w]=(0,l.useState)(e.initialWeights),[y,b]=(0,l.useState)(!1),[N,v]=(0,l.useState)(null),k=(0,l.useRef)(0),C=(0,l.useRef)(null),z=(0,l.useRef)(null),S=(0,l.useRef)(new Map),A=(0,l.useCallback)(()=>{k.current+=1,z.current=null,g([]),_([]),b(!1),v(null)},[]),E=(0,l.useCallback)(t=>{var s,l,r;g(null!=(s=t.results)?s:[]),_(null!=(l=t.suggestions)?l:[]),w(null!=(r=t.weights)?r:e.initialWeights),v(null)},[e.initialWeights]),M=(0,l.useCallback)(async(t,s,l)=>{if(z.current===s)return;let r=k.current+1;k.current=r,z.current=s,l||(b(!0),v(null));try{let l=await h();if(r!==k.current)return;let i=e.initialWeights,x=(function(e,t,s){let l=c(s);return e.map(e=>{let{score:s,matchedFields:r}=a(e,t,l);return{song:e,score:s,matched_fields:r}}).filter(e=>e.score>0).sort((e,t)=>t.score-e.score||e.song.title.localeCompare(t.song.title))})(l,t,i).slice(0,50),m=d?function(e,t,s){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,r=n(t);if(!r)return[];let i=c(s),u=Math.max(1,Math.floor(.45*r.length));return e.map(e=>{let t=function(e,t){let s=n(t),l=n(e.title);if(!s||!l)return 1/0;if(l===s)return 0;if(!l.length)return s.length;if(!s.length)return l.length;let r=Array.from({length:l.length+1},(e,t)=>Array.from({length:s.length+1},(e,s)=>0===t?s:0===s?t:0));for(let e=1;e<=l.length;e+=1)for(let t=1;t<=s.length;t+=1){let n=+(l[e-1]!==s[t-1]);r[e][t]=Math.min(r[e-1][t]+1,r[e][t-1]+1,r[e-1][t-1]+n)}return r[l.length][s.length]}(e,r);if(!(t<=u))return null;let{score:s}=a(e,r,i),l=s+i.fuzzy_weight;return{song_id:e.id,title:e.title,score:l,distance:t}}).filter(e=>!!e).sort((e,t)=>t.score-e.score||e.distance-t.distance||e.title.localeCompare(t.title)).slice(0,l)}(l,t,i,8):[],f={query:t,weights:i,results:x,suggestions:m};E(f);let g=Date.now();u.set(s,{expiresAt:g+o,fetchedAt:g,payload:f}),S.current.set(s,g)}catch(e){if(r!==k.current)return;l||(g([]),_([]),v(e instanceof Error?e.message:"Unknown error"))}finally{r!==k.current||l||b(!1),z.current===s&&(z.current=null)}},[E,o,d,e.initialWeights]),T=(0,l.useCallback)(async(e,t)=>{var s,l;let r=e.trim();if(!r)return void A();let n=function(e,t){let s=e.trim().normalize("NFC").toLowerCase();return"".concat(t?"1":"0",":").concat(s)}(r,d),i=Date.now();for(let[e,t]of u.entries())t.fetchedAt+12e4<=i&&u.delete(e);for(;u.size>120;){let e=u.keys().next().value;if(!e)break;u.delete(e)}let a=u.get(n);t&&a&&(E(a.payload),b(!1));let c=!!(a&&a.expiresAt>i),o=null!=(l=null!=(s=S.current.get(n))?s:null==a?void 0:a.fetchedAt)?l:0;if(t&&c){i-o>350&&z.current!==n&&M(r,n,!0);return}(!t||z.current!==n)&&(t&&i-o<=350||await M(r,n,t&&!!a))},[E,M,d,A]);(0,l.useEffect)(()=>(null!==C.current&&(window.clearTimeout(C.current),C.current=null),x.trim())?(C.current=window.setTimeout(()=>{T(x,!0)},i),()=>{null!==C.current&&(window.clearTimeout(C.current),C.current=null)}):void A(),[i,x,A,T]),(0,l.useEffect)(()=>()=>{null!==C.current&&window.clearTimeout(C.current)},[]);let F=(0,l.useCallback)(async()=>{await T(x,!0)},[x,T]);return{query:x,setQuery:m,results:f,suggestions:p,weights:j,loading:y,error:N,searchNow:F}}},2853:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>o});var l=s(5155),r=s(2619),n=s.n(r);function i(e){var t;let{result:s}=e;return(0,l.jsxs)("article",{className:"panel p-5",children:[(0,l.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-xl font-bold text-[#131b2e]",children:(0,l.jsx)(n(),{href:"/song/".concat(s.song.id),className:"hover:underline",children:s.song.title})}),(0,l.jsx)("p",{className:"mt-1 text-sm text-slate-500",children:null!=(t=s.song.artist)?t:"Unknown Artist"})]}),(0,l.jsxs)("span",{className:"rounded-full bg-[#1f57d9]/10 px-3 py-1 text-sm font-semibold text-[#1f57d9]",children:["Score ",s.score]})]}),(0,l.jsxs)("div",{className:"mt-4 space-y-2 text-sm text-slate-700",children:[(0,l.jsxs)("p",{children:[(0,l.jsx)("span",{className:"font-semibold",children:"Chorus:"})," ",s.song.chorus_first_line]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("span",{className:"font-semibold",children:"Verse 1:"})," ",s.song.verse1_first_line]})]}),(0,l.jsx)("div",{className:"mt-4 flex flex-wrap gap-2",children:s.matched_fields.map(e=>(0,l.jsx)("span",{className:"rounded-md bg-slate-100 px-2 py-1 text-xs font-medium text-slate-600",children:e},e))})]})}var a=s(1296),c=s(4484);let u={title_exact:100,title_partial:60,chorus_weight:55,verse1_weight:45,lyrics_weight:20,unit_weight:15,fuzzy_weight:10};function o(){let{query:e,setQuery:t,results:s,suggestions:r,weights:o,loading:d,error:h,searchNow:x}=(0,a.P)({initialWeights:u,includeSuggestions:!0});return(0,l.jsxs)("section",{className:"space-y-6",children:[(0,l.jsxs)("div",{className:"panel p-6",children:[(0,l.jsx)("h1",{className:"text-3xl font-black text-strong",children:"Search Engine"}),(0,l.jsx)("p",{className:"mt-2 text-sm text-soft",children:"title / chorus_first_line / verse1_first_line / lyrics_full / two_line_units"}),(0,l.jsxs)("form",{className:"mt-5 flex gap-3",onSubmit:e=>{e.preventDefault(),x()},children:[(0,l.jsx)("input",{className:"input flex-1",placeholder:"곡 제목 또는 가사 일부를 입력하세요",value:e,onChange:e=>t(e.target.value)}),(0,l.jsx)("button",{type:"submit",className:"btn-primary min-w-[120px]",disabled:d,children:d?"Searching...":"Search"})]}),(0,l.jsx)("p",{className:"mt-2 text-xs font-semibold text-muted",children:"입력 즉시 DB 결과가 아래에 표시됩니다."}),e.trim()?(0,l.jsxs)("div",{className:"mt-3 rounded-[2px] border-2 border-soft bg-solid p-3",children:[(0,l.jsxs)("p",{className:"text-xs font-semibold uppercase tracking-[0.08em] text-muted",children:["DB Matches (",s.length,")"]}),(0,l.jsx)("div",{className:"mt-2 max-h-52 space-y-2 overflow-y-auto pr-1",children:d?(0,l.jsx)("p",{className:"text-sm text-muted",children:"검색 중..."}):s.length>0?s.slice(0,12).map((e,t)=>(0,l.jsxs)(n(),{href:"/song/".concat(e.song.id),prefetch:!1,className:"block rounded-[2px] border border-soft bg-panel px-3 py-2 text-sm transition hover:border-[var(--primary)]",children:[(0,l.jsx)("p",{className:"text-[11px] font-medium text-muted",children:(0,c.b)(e.song)}),(0,l.jsx)("p",{className:"font-semibold text-strong",children:e.song.title})]},"".concat(e.song.id,"-").concat(t))):(0,l.jsx)("p",{className:"text-sm text-muted",children:"일치하는 곡이 없습니다."})})]}):null,(0,l.jsxs)("div",{className:"mt-5 grid gap-2 text-xs text-muted sm:grid-cols-2 lg:grid-cols-4",children:[(0,l.jsxs)("p",{children:["Title Exact: ",o.title_exact]}),(0,l.jsxs)("p",{children:["Title Partial: ",o.title_partial]}),(0,l.jsxs)("p",{children:["Chorus: ",o.chorus_weight]}),(0,l.jsxs)("p",{children:["Verse1: ",o.verse1_weight]}),(0,l.jsxs)("p",{children:["Lyrics: ",o.lyrics_weight]}),(0,l.jsxs)("p",{children:["Two-line Units: ",o.unit_weight]}),(0,l.jsxs)("p",{children:["Fuzzy Bonus (suggestions): ",o.fuzzy_weight]})]}),h?(0,l.jsx)("p",{className:"mt-4 text-sm font-medium text-red-600",children:h}):null]}),(0,l.jsxs)("div",{className:"grid gap-6 lg:grid-cols-[1fr_320px]",children:[(0,l.jsxs)("section",{className:"space-y-4",children:[(0,l.jsxs)("h2",{className:"text-xl font-bold text-strong",children:["Results (",s.length,")"]}),s.length>0?s.map((e,t)=>(0,l.jsx)(i,{result:e},"".concat(e.song.id,"-").concat(t))):(0,l.jsx)("div",{className:"panel p-6 text-sm text-soft",children:"검색 결과가 없습니다."})]}),(0,l.jsxs)("aside",{className:"panel h-fit p-5",children:[(0,l.jsx)("h2",{className:"text-base font-semibold text-strong",children:"Suggestions (Fuzzy)"}),(0,l.jsx)("p",{className:"mt-1 text-xs text-muted",children:"Fuzzy bonus applies only here."}),(0,l.jsx)("div",{className:"mt-4 space-y-2",children:r.length>0?r.map(e=>(0,l.jsxs)(n(),{href:"/song/".concat(e.song_id),prefetch:!1,className:"block rounded-lg border border-soft bg-panel px-3 py-2 text-sm transition hover:border-[var(--primary)]",children:[(0,l.jsx)("p",{className:"font-semibold text-strong",children:e.title}),(0,l.jsxs)("p",{className:"text-xs text-muted",children:["score ",e.score," / distance ",e.distance]})]},e.song_id)):(0,l.jsx)("p",{className:"text-sm text-muted",children:"추천 결과가 없습니다."})})]})]})]})}},4484:(e,t,s)=>{"use strict";function l(e){return e?e.trim():""}function r(e){let t=l(e.artist),s=l(e.ccli_number),r=l(e.copyright_holder),n=[];return(t&&n.push(t),s&&n.push("CCLI ".concat(s)),r&&n.push(r),0===n.length)?"Unknown Artist":n.join(" \xb7 ")}s.d(t,{b:()=>r})},4817:(e,t,s)=>{Promise.resolve().then(s.bind(s,2853))}},e=>{e.O(0,[619,441,255,358],()=>e(e.s=4817)),_N_E=e.O()}]);